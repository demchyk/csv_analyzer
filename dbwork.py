import sqlite3
import pandas as pd

conn = sqlite3.connect('basa.db')
cur = conn.cursor()

# a = 'C901000003, C901000001, C901000026, C901000023, C901000008, C901000004, C901170037, C901170008, C901170034, C901000002, C901000024, C901180021, C901000025, C901000030, C901180034, C901180008, C901170021, C901180037'
# a = ['MAX(' + elem.strip() + ')' + 'AS ' + elem for elem in a.split(',')]

# q = f''' SELECT COLLECTTIME,BTSNAME,SITEID, {",".join(a)} FROM table_temp GROUP BY COLLECTTIME,BTSNAME,SITEID  '''

# df = pd.read_sql_query(q,conn)
# df.fillna(0,inplace=True)
# df.to_sql('table_notemp',conn,if_exists = 'replace', index = False)


# df = pd.read_sql_query('SELECT * from table_temp',conn)
# df = df.fillna(0)

Call_Completion = '100 * (C901260063 + C901260088 + C901270063 + C901270088 + C901050061)/(C901260020 + C901260069 + C901270020 + C901270069 + C901050060)'
DL_Qual = '100*(C901120125 + C901120126 + C901120127 + C901120128 + C901120129 + C901120130)/(C901120125 + C901120126 + C901120127 + C901120128 + C901120129 + C901120130 + C901120131 + C901120132)'
DL_TBF_SR = '100 * ((C901000002 + C901000003 + C901000004 + C901000008 + C901000024 + C901000025 + C901000026 + C901000030 + C901170021 + C901180021 + C901170034 + C901180034 + C901000001 + C901000023) - (C901170008 + C901170037 + C901180008 + C901180037))/(C901000002 + C901000003 + C901000004 + C901000008 + C901000024 + C901000025 + C901000026 + C901000030 + C901170021 + C901180021 + C901170034 + C901180034 + C901000001 + C901000023)'

q = (f''' SELECT COLLECTTIME,BTSNAME,SITEID, {Call_Completion} AS CALL, {DL_Qual} AS BALL, {DL_TBF_SR} AS RALL  FROM table_notemo ''')
df = pd.read_sql_query(q,conn)
df.to_sql('metrics',conn, if_exists = 'replace')
conn.close()



# FGUCL340_G08A

